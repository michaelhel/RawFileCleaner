<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <title>RawFileCleaner</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <!--===============================================================================================-->
   <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="css/util.css">
   <link rel="stylesheet" type="text/css" href="css/main.css">
   <!--===============================================================================================-->
   <link rel="stylesheet" type="text/css" href="style.css" />
   <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
   <script src="script.js"></script>
</head>

<body>
   <div id="container">
      Are you sure you want to delete these files?
      <p id="sum" onmouseover="cuteCats()" onmouseout="removeCats()"></p>
      <div>
         <a href="selectSource.html">
                <img id="imgUndo" src="img/undo.svg" />
         </a>
         <a>
            <img id="imgConfirm" src="img/confirm.svg" onclick="cleanFiles(true)" />
         </a>
      </div>
      <div class="table100 ver3 m-b-110">
         <div class="table100-head">
            <table>
               <thead>
                  <tr class="row100 head">
                     <th class="cell100 column1">Filename</th>
                     <th class="cell100 column2">Directory</th>
                     <th class="cell100 column3">Size</th>
                  </tr>
               </thead>
            </table>
         </div>
         <div class="table100-body js-pscroll">
            <table>
               <tbody id="tbody">
               </tbody>
            </table>
         </div>
      </div>
   </div>
   <script type="text/javascript">
      window.onload = view;
      var remote = require('electron').remote;
      var electronFs = remote.require('fs');
      const storage = require('electron-json-storage');
      var sum;
      var cats;
      document.addEventListener('keydown', function(e) {
         if (e.which === 123) {
            remote.getCurrentWindow().webContents.openDevTools();
         } else if (e.which === 116) {
            location.reload();
         }
      });

      function view() {
         storage.get('deletedFiles', function(error, data) {
            if (error) throw error;

            var body = "";
            sum = 0;
            for (var i = 0; i < data.length; i++) {
               stats = electronFs.statSync(data[i].path + "/" + data[i].fileName);
               sum += stats.size / 1000000.0;
            }
            sum = Math.round(sum * 100) / 100;
            document.getElementById("sum").innerHTML = "By deleting you will free " + sum + "MB";
            cats = Math.round(sum / 1.5) * 10; //0.15 MB is the size of an average cat pic

            for (var i = 0; i < data.length; i++) {
               body += "<tr class=\"row100 body\">";
               body += "<td class=\"cell100 column1\">";
               body += data[i].fileName + "</td>";
               body += "<td class=\"cell100 column2\">";
               body += data[i].dir + "</td>";
               stats = electronFs.statSync(data[i].path + "/" + data[i].fileName);
               fileSizeInMB = stats.size / 1000000.0;
               body += "<td class=\"cell100 column3\">";
               body += fileSizeInMB.toFixed(2) + " MB</td>";
               body += "</tr>";
            }
            document.getElementById('tbody').innerHTML = body;
         });
      }

      function cuteCats() {
         document.getElementById("sum").innerHTML = "That's enough storage for about " + cats + " cute cat pics";
      }

      function removeCats() {
         document.getElementById("sum").innerHTML = "By deleting you will free " + sum + "MB";
      }
   </script>
   <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
   <script src="vendor/bootstrap/js/popper.js"></script>
   <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
   <script src="vendor/select2/select2.min.js"></script>
   <script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
   <script src="js/main.js"></script>
   <script>
      $('.js-pscroll').each(function() {
         var ps = new PerfectScrollbar(this);

         $(window).on('resize', function() {
            ps.update();
         })
      });
   </script>
</body>

</html>