<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>RawFileCleaner</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="script.js"></script>
</head>

<body>
    <div id="container">
        Are you sure you want to delete these files?
        <div>
            <a href="selectSource.html">
                <img id="imgUndo" src="img/undo.svg" />
            </a>
            <a>
                <img id="imgConfirm" src="img/confirm.svg" onclick="cleanFiles(true)" />
            </a>
        </div>

        <div id="tableData"></div>
    </div>

    <script type="text/javascript">
        window.onload = view;

        function view() {
            const storage = require('electron-json-storage');
            storage.get('deletedFiles', function(error, data) {
                if (error) throw error;
                var container = document.getElementById("tableData");
                var table = document.createElement('table');
                var tbody = document.createElement('tbody');

                var sum = 0;
                for (var i = 0; i < data.length; i++) {
                    stats = electronFs.statSync(data[i].path + "/" + data[i].fileName);
                    fileSizeInMB = stats.size / 1000000.0;
                    var cell = document.createElement('td');
                    sum += fileSizeInMB;
                }
                var row = document.createElement('tr');
                var cell = document.createElement('td');
                cell.textContent = "Sum of Space which will be freed up:";
                cell.style.textAlign = "center";
                row.appendChild(cell);
                var cell = document.createElement('td');
                cell.textContent = sum.toFixed(2) + "MB";
                cell.style.textAlign = "center";
                row.appendChild(cell);
                tbody.appendChild(row);


                var row = document.createElement('tr');
                var head = document.createElement('th');
                head.textContent = "Filename";
                head.style.textAlign = "left";
                row.appendChild(head);
                var head = document.createElement('th');
                head.textContent = "Path";
                head.style.textAlign = "left";
                row.appendChild(head);
                var head = document.createElement('th');
                head.textContent = "Size";
                head.style.textAlign = "left";
                row.appendChild(head);
                tbody.appendChild(row);
                var Parent = document.getElementById("tableData");
                while (Parent.hasChildNodes()) {
                    Parent.removeChild(Parent.firstChild);
                }
                //0,150mb fÃ¼r katzenbild
                var stats = -1;
                var fileSizeInMB = -1;


                for (var i = 0; i < data.length; i++) {
                    var row = document.createElement('tr');
                    var cell = document.createElement('td');
                    cell.textContent = data[i].fileName;
                    cell.style.textAlign = "left";
                    row.appendChild(cell);
                    var cell = document.createElement('td');
                    cell.textContent = data[i].path;
                    cell.style.textAlign = "left";
                    row.appendChild(cell);
                    stats = electronFs.statSync(data[i].path + "/" + data[i].fileName);
                    fileSizeInMB = stats.size / 1000000.0;
                    var cell = document.createElement('td');
                    cell.textContent = fileSizeInMB.toFixed(2) + "MB";
                    cell.style.textAlign = "left";
                    row.appendChild(cell);
                    tbody.appendChild(row);
                }
                table.appendChild(tbody);
                table.style.width = "80%";
                table.style.alignContent = "left";
                container.appendChild(table);
            });
        }


        var remote = require('electron').remote;
        var electronFs = remote.require('fs');

        storage = require('electron-json-storage');
        document.addEventListener('keydown', function(e) {
            if (e.which === 123) {
                remote.getCurrentWindow().webContents.openDevTools();
            } else if (e.which === 116) {
                location.reload();
            }
        });
    </script>
</body>

</html>