<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <title>RawFileCleaner</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" type="text/css" href="style.css" />
   <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
   <script src="script.js"></script>
</head>

<body onload="setProgressbar(1)">
   <div id="confirmContainer">
      <div>
         <a href="index.html"><img id="imgUndo" src="img/undo.svg" /></a>
         <a><img id="imgConfirm" src="img/confirm.svg" onclick="cleanFiles(true)" /></a>
      </div>
      <div>
         Are you sure you want to delete these files?
         <p id="sum" onmouseover="cuteCats()" onmouseout="removeCats()"></p>
      </div>
      <div>
         <table id="fileTable">
            <thead>
               <tr>
                  <th>Filename</th>
                  <th>Directory</th>
                  <th>Size</th>
               </tr>
            </thead>
            <tbody id="fileTableBody">
            </tbody>
         </table>
      </div>
   </div>
   <div id="progressbar"></div>
   <script type="text/javascript">
      window.onload = view;
      var remote = require('electron').remote;
      var electronFs = remote.require('fs');
      const storage = require('electron-json-storage');
      document.addEventListener('keydown', function(e) {
         if (e.which === 123) {
            remote.getCurrentWindow().webContents.openDevTools();
         } else if (e.which === 116) {
            location.reload();
         }
      });

      var sum;
      var cats;

      function view() {
         storage.get('deletedFiles', function(error, deletedFiles) {
            if (error) throw error;

            var body = "";
            sum = 0;
            for (var i = 0; i < deletedFiles.length; i++) {
               stats = electronFs.statSync(deletedFiles[i].path + "/" + deletedFiles[i].fileName);
               sum += stats.size / 1000000.0;
            }
            sum = Math.round(sum * 100) / 100;
            document.getElementById("sum").innerHTML = "By deleting you will free " + sum + "MB";
            cats = Math.round(sum / 1.5) * 10; //0.15 MB is the size of an average cat pic

            for (var i = 0; i < deletedFiles.length; i++) {
               body += "<tr>";
               body += "<td>";
               body += deletedFiles[i].fileName + "</td>";
               body += "<td>";
               body += deletedFiles[i].dir + "</td>";
               stats = electronFs.statSync(deletedFiles[i].path + "/" + deletedFiles[i].fileName);
               fileSizeInMB = stats.size / 1000000.0;
               body += "<td>";
               body += fileSizeInMB.toFixed(2) + " MB</td>";
               body += "</tr>";
            }
            document.getElementById('fileTableBody').innerHTML = body;
         });
      }

      function cuteCats() {
         document.getElementById("sum").innerHTML = "That's enough storage for about " + cats + " cute cat pics";
      }

      function removeCats() {
         document.getElementById("sum").innerHTML = "By deleting you will free " + sum + "MB";
      }
   </script>
</body>

</html>